services:
    php:
        # PC1 (DEV) :
        # build: .   ‚Üí utile pour reconstruire l‚Äôimage √† partir du Dockerfile
        #
        # PC2 (EXECUTION) :
        # ‚ùå build: .  (√† SUPPRIMER)
        # ‚úÖ utiliser l‚Äôimage Docker Hub d√©j√† construite
        build: .
        # image: haltarion/ecoride:php-v1
        container_name: symfony-php
        working_dir: /var/www
        volumes:
            # PC1 :
            # Ces volumes permettent le d√©veloppement (code local mont√© dans le conteneur)
            #
            # PC2 :
            # ‚ùå √Ä SUPPRIMER si le code n‚Äôest PAS pr√©sent sur la machine
            # (l‚Äôimage contient d√©j√† le code via COPY . .)
            - ./assets:/var/www/assets
            - ./bin:/var/www/bin
            - ./config:/var/www/config
            - ./migrations:/var/www/migrations
            - ./public:/var/www/public
            - ./src:/var/www/src
            - ./templates:/var/www/templates

            # VAR PERSISTANTS
            - var_data:/var/www/var

            # fichiers sp√©cifiques
            # PC1 : OK
            # PC2 :
            # ‚ùå √† supprimer si ces fichiers n‚Äôexistent pas sur PC2
            - ./composer.json:/var/www/composer.json
            - ./composer.lock:/var/www/composer.lock
            - ./importmap.php:/var/www/importmap.php
            # Fichiers d‚Äôenvironnement
            # PC1 : OK
            # PC2 :
            # ‚ùå √† supprimer si .env / .env.local n‚Äôexistent pas
            # üëâ Sur PC2, pr√©f√©rer "environment:" ou un .env pr√©sent localement
            - ./.env:/var/www/.env
            - ./.env.local:/var/www/.env.local
        networks:
            - symfony

    nginx:
        image: nginx:1.29
        container_name: symfony-nginx
        ports:
            - "8080:80"
        volumes:
            # PC1 :
            # OK pour le d√©veloppement
            #
            # PC2 :
            # ‚ùå √† supprimer si le code n‚Äôest pas pr√©sent
            - ./src:/var/www/src
            - ./config:/var/www/config
            - ./templates:/var/www/templates
            - ./public:/var/www/public
            - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
        depends_on:
            - php
        networks:
            - symfony

    db:
        image: mariadb:10.11
        container_name: symfony-db
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: app
            MYSQL_USER: app
            MYSQL_PASSWORD: app
        ports:
            - "3307:3306"
        volumes:
            - db_data:/var/lib/mysql
        networks:
            - symfony

    pma:
        image: phpmyadmin/phpmyadmin:5.2
        container_name: symfony-pma
        restart: always
        depends_on:
            - db
        ports:
            - "8081:80"
        environment:
            PMA_HOST: db
            PMA_USER: app
            PMA_PASSWORD: app
        networks:
            - symfony

networks:
    symfony:

volumes:
    db_data:
    var_data:
